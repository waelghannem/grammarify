var spellchecker=require("spellchecker");function Grammarify(){var e=new Grammarify_PreProcess,r=new Grammarify_SMS,t=new Grammarify_Disconnected;new Grammarify_Numbers;return{clean:function(n){if(0===n.length)return"";n=n.replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"'),n=e.fixPeriodAndEllipsis(n);var a=(n=e.fixSpaceAfterCharacter(n)).split(" ").filter(e=>0!==e.length);a=r.fixStretching(a),a=r.fixShorthand(a),a=t.fixSeparated(a);for(var i=[],s=0;s<a.length;s++)a[s].indexOf(".")>=0?i.push("."):a[s].indexOf("!")>=0?i.push("!"):a[s].indexOf("?")>=0?i.push("?"):i.push("");var l,o=["the","a","an","and","but","or","nor","for","so","yet"],f=[],h=!1,u="",g="";for(s=0;s<a.length;s++)s>0&&a[s]===a[s-1].trim().toLowerCase()&&o.indexOf(a[s].toLowerCase())>=0?(a.splice(s,1),s--):(u=null!==(g=a[s].match(/[\W]+$/g))?a[s].replace(/[\W]+$/g,""):a[s],spellchecker.isMisspelled(u)&&(f=spellchecker.getCorrectionsForMisspelling(u)).length>0&&(a[s]=f[0],f=[],null!==g&&(a[s]=a[s]+g[0])),s>0&&(h=""!==i[s-1]),(0===s||h)&&(a[s]=a[s][0].toUpperCase()+a[s].substr(1)),0!==s&&(a[s]=" "+a[s]));var c=a.length-1;return"."!==(l=a[c][a[c].length-1])&&"!"!==l&&"?"!==l&&(a[c]=a[c]+"."),a.join("")}}}function Grammarify_PreProcess(){var e=[",",";",":","%"],r=function(e,r){var t=new RegExp("^[ \\"+r+".]+","g");e=e.replace(t,""),t=new RegExp("\\b([ \\"+r+"]*\\"+r+"[ \\"+r+"]*)(\\b|$)","g");var n=e.match(t),a=0,i="";if(null!==n)for(var s=0;s<n.length;s++)a=e.indexOf(n[s],a),i=e.substr(a),i=a+n[s].length<e.length&&null!==e[a+n[s].length+1].match(/\d/)?i.replace(n[s],r):i.replace(n[s],r+" "),e=e.substr(0,a)+i,a++;return e};return{fixPeriodAndEllipsis:function(e){var r=(e=e.replace(/^[ \.]+/g,"")).match(/\b([ \.]*\.[ \.]*)(\b|$)/g),t=0,n="";if(null!==r)for(var a=0;a<r.length;a++)t=e.indexOf(r[a],t),2==r[a].split(".").length?(n=(n=e.substr(t)).replace(r[a],". "),e=e.substr(0,t)+n,t++):r[a].split(".").length>=3&&(n=(n=e.substr(t)).replace(r[a],"... "),e=e.substr(0,t)+n,t++);return e},fixSpaceAfterCharacter:function(t){for(var n=0;n<e.length;n++)t=r(t,e[n]);return t}}}function Grammarify_SMS(){var e={"2night":"tonight","2nite":"tonight",asap:"as soon as possible",asl:"American Sign Language",bc:"because",bf:"boyfriend",btw:"by the way",cuz:"because",eg:"example",els:"else",f:"female",ftw:"for the win",fyi:"for your information",gf:"girlfriend",gotta:"got to",gr8:"great",hada:"had a",hmu:"hit me up",hr:"hour",hrs:"hours",idk:"I don't know",im:"I'm",jude:"Jude",kinda:"kind of",m:"male",msg:"message",nite:"night",omg:"oh my gosh",pls:"please",plz:"please",ppl:"people",tbh:"to be honest",tho:"though",thru:"through",tryna:"trying to",u:"you",w:"with",wanna:"want to",whaat:"what",whaaat:"what",wk:"week",wks:"weeks",wtf:"what the fuck",wth:"what the heck",wya:"where are you at",yknow:"you know"},r=function(t,n,a){if(void 0!==e[t])return e[t];if(spellchecker.isMisspelled(t)){if(0===n.reduce((e,r)=>e+(r.endIndex-r.startIndex),0))return"";var i=a>0?a-1:n.length-1;return n[i].endIndex>n[i].startIndex?(n[i].endIndex=n[i].endIndex-1,t=t.substr(0,n[i].startIndex)+t.substr(n[i].startIndex+1)):a>0?a-=1:a=n.length-1,r(t,n,a)}return t};return{fixStretching:function(e){var t=[];if(Array.isArray(e))t=e;else{if("string"!=typeof e)return"";t=e.split(" ")}for(var n=[],a="",i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)s>0&&(t[i][s]===t[i][s-1]?""===a?(n.push({startIndex:s-1,endIndex:s}),a=t[i][s]):n[n.length-1].endIndex=s:a="");if(n.length>0&&void 0!==t[i]&&spellchecker.isMisspelled(t[i]))for(var l="",o=JSON.parse(JSON.stringify(n)),f=0;f<o.length;f++){if(""!==(l=r(t[i],o,f))){t[i]=l;break}o=JSON.parse(JSON.stringify(n))}n=[],a=""}return t},fixShorthand:function(r){var t="",n=[],a="";if(Array.isArray(r))n=r;else{if("string"!=typeof r)return"";n=r.split(" ")}for(var i=0;i<n.length;i++)""!=typeof(a=n[i].match(/([a-zA-Z0-9']*)([\?!\.;+]*)$/))[2]&&(t=a[2]),a=a[1],void 0!==e[a]&&(n[i]=e[a],""!==t&&(n[i]=n[i]+t,t=""));return n}}}function Grammarify_Disconnected(){var e=["awesome","everything","herself","himself","nowhere","today","yourself"];return{fixSeparated:function(r){var t=[];if(Array.isArray(r))t=r;else{if("string"!=typeof r)return"";t=r.split(" ")}var n=0;if(t.length>1)for(var a=1;a<t.length;a++)(n=e.indexOf((t[a-1]+t[a]).toLowerCase()))>=0&&(t[a-1]=e[n],t.splice(a,1),a--);return t}}}function Grammarify_Numbers(){}exports=module.exports=new Grammarify;